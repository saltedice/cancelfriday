<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancel Friday | SALT - Subscribers Against Lawless Tyranny</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Black+Ops+One&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #0a0a0a;
            --white: #f0f0e8;
            --red: #e63946;
            --orange: #f77f00;
            --salt: #e8e4d9;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.04;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.5rem 1.5rem;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 2px solid var(--white);
        }

        .logo {
            font-family: 'Black Ops One', cursive;
            font-size: clamp(5rem, 15vw, 8rem);
            color: var(--salt);
            text-shadow: 5px 5px 0 var(--red);
            letter-spacing: 0.08em;
            line-height: 1;
            text-transform: uppercase;
        }

        .acronym {
            font-size: clamp(0.7rem, 2vw, 1rem);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0.7;
            margin-top: 0.5rem;
        }

        /* Countdown */
        .countdown-bar {
            text-align: center;
            padding: 1.25rem 1rem;
            background: linear-gradient(90deg, rgba(230,57,70,0.2), rgba(247,127,0,0.2));
            border-bottom: 2px solid var(--red);
        }

        .countdown-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            letter-spacing: 0.15em;
            color: var(--orange);
            margin-bottom: 0.5rem;
        }

        .countdown-timer {
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 700;
            color: var(--white);
            letter-spacing: 0.05em;
        }

        .countdown-timer .cd-unit {
            display: inline-block;
            min-width: 2.5ch;
            text-align: center;
        }

        .countdown-timer .cd-sep {
            opacity: 0.4;
            margin: 0 0.15em;
        }

        .countdown-timer .cd-label {
            display: block;
            font-size: 0.55rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            opacity: 0.5;
            margin-top: 0.1rem;
        }

        .countdown-done {
            color: var(--red);
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            letter-spacing: 0.1em;
        }

        /* Mission Statement */
        .mission {
            text-align: center;
            padding: 2rem 1rem;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .mission-text {
            font-size: clamp(0.85rem, 2vw, 1rem);
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
            color: rgba(240, 240, 232, 0.85);
        }

        .mission-text strong {
            color: var(--red);
            font-weight: 700;
        }

        .mission-steps {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            color: var(--orange);
            letter-spacing: 0.08em;
            margin-top: 1.25rem;
        }

        .mission-tagline {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(1.5rem, 4vw, 2rem);
            color: var(--salt);
            margin-top: 0.75rem;
            letter-spacing: 0.05em;
        }

        /* This Week Section */
        .this-week {
            text-align: center;
            padding: 3rem 1rem;
            background: linear-gradient(180deg, rgba(230, 57, 70, 0.15) 0%, transparent 100%);
            border-bottom: 2px solid var(--red);
        }

        .week-badge {
            display: inline-block;
            background: var(--red);
            padding: 0.4rem 1rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }

        .section-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            opacity: 0.5;
            margin-bottom: 0.5rem;
        }

        .current-target {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(3.5rem, 12vw, 6rem);
            line-height: 1;
            color: var(--white);
            margin-bottom: 0.25rem;
        }

        .current-parent {
            font-size: 0.7rem;
            opacity: 0.4;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 2rem;
        }

        /* Why This Company */
        .why-box {
            background: rgba(230, 57, 70, 0.1);
            border: 1px solid rgba(230, 57, 70, 0.3);
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: left;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .why-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            color: var(--red);
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
        }

        .why-list {
            list-style: none;
            font-size: 0.7rem;
            line-height: 1.8;
            opacity: 0.85;
        }

        .why-list li {
            padding-left: 1rem;
            position: relative;
        }

        .why-list li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--red);
        }

        /* How To Cancel */
        .how-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: left;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .how-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            color: var(--orange);
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
        }

        .how-steps {
            list-style: none;
            font-size: 0.7rem;
            line-height: 1.8;
            counter-reset: step;
        }

        .how-steps li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .how-steps li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            color: var(--orange);
            font-weight: 700;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
        }

        .cancel-link {
            display: inline-block;
            margin-top: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--orange);
            color: var(--black);
            text-decoration: none;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .cancel-link:hover {
            background: var(--white);
        }

        /* Drop Time */
        .drop-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .drop-datetime {
            text-align: center;
        }

        .drop-label {
            font-size: 0.55rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            opacity: 0.5;
        }

        .drop-date {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.6rem;
            color: var(--orange);
        }

        .countdown-box {
            background: var(--black);
            border: 2px solid var(--red);
            padding: 1rem 1.5rem;
            text-align: center;
        }

        .countdown-label {
            font-size: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            opacity: 0.5;
            margin-bottom: 0.25rem;
        }

        .countdown {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--red);
            letter-spacing: 0.05em;
        }

        .participants-count {
            margin-bottom: 2rem;
        }

        .participants-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            color: var(--salt);
            line-height: 1;
        }

        .participants-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.6;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .commit-btn {
            background: var(--white);
            color: var(--black);
            border: none;
            padding: 1rem 2.5rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .commit-btn:hover {
            background: var(--red);
            color: var(--white);
            transform: scale(1.02);
        }

        .commit-btn.committed {
            background: var(--red);
            color: var(--white);
        }

        .commit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .share-btn {
            background: var(--orange);
            color: var(--black);
            border: none;
            padding: 1rem 3rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.6rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 0 20px rgba(247, 127, 0, 0.4);
        }

        .share-btn:hover {
            background: var(--white);
            color: var(--black);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .vote-summary {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            background: rgba(247, 127, 0, 0.1);
            border: 1px solid rgba(247, 127, 0, 0.3);
            text-align: center;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .vote-summary-text {
            font-size: 0.75rem;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .vote-summary-text strong {
            color: var(--orange);
        }

        .vote-comparison {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
            font-size: 0.6rem;
            opacity: 0.7;
        }

        .vote-comparison span {
            white-space: nowrap;
        }

        .change-vote-btn {
            background: none;
            border: none;
            color: var(--orange);
            font-family: 'Inter', sans-serif;
            font-size: 0.6rem;
            cursor: pointer;
            text-decoration: underline;
            opacity: 0.7;
            margin-top: 0.5rem;
            padding: 0;
        }

        .change-vote-btn:hover {
            opacity: 1;
        }

        .cancel-preview {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .cancel-preview-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--orange);
            margin-bottom: 0.5rem;
        }

        .cancel-preview-steps {
            font-size: 0.6rem;
            opacity: 0.7;
            padding-left: 1.2rem;
        }

        .cancel-preview-steps li {
            margin-bottom: 0.25rem;
        }

        .commit-note {
            margin-top: 1rem;
            font-size: 0.6rem;
            opacity: 0.5;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Step Badges */
        .step-badge {
            display: inline-block;
            background: var(--orange);
            color: var(--black);
            padding: 0.3rem 0.8rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
        }

        .step-badge.step-2 {
            background: var(--red);
            color: var(--white);
        }

        /* Vote Section */
        .vote-section {
            padding: 3rem 1rem;
            text-align: center;
            border-bottom: 2px solid var(--orange);
            background: linear-gradient(180deg, rgba(247, 127, 0, 0.1) 0%, transparent 100%);
        }

        .vote-header {
            margin-bottom: 2rem;
        }

        .vote-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            color: var(--orange);
        }

        .vote-subtitle {
            font-size: 0.7rem;
            opacity: 0.6;
            line-height: 1.6;
        }

        .current-leader {
            background: rgba(247, 127, 0, 0.15);
            border: 2px solid var(--orange);
            padding: 1.5rem;
            margin-bottom: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .leader-label {
            font-size: 0.55rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0.6;
            margin-bottom: 0.25rem;
        }

        .leader-target {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--orange);
            line-height: 1;
        }

        .leader-votes {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }

        .vote-count-total {
            margin-top: 2rem;
            font-size: 0.7rem;
            opacity: 0.5;
        }

        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            text-align: center;
        }

        @media (max-width: 900px) {
            .candidates-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .candidates-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .candidate-card {
            border: 2px solid rgba(255,255,255,0.2);
            padding: 1.25rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            text-align: center;
        }

        .candidate-card:hover {
            border-color: var(--white);
            background: rgba(255,255,255,0.03);
        }

        .candidate-card.selected {
            border-color: var(--orange);
            border-width: 3px;
            background: rgba(247, 127, 0, 0.15);
            transform: scale(1.03);
            box-shadow: 0 0 20px rgba(247, 127, 0, 0.3);
        }

        .candidate-card.voted {
            border-color: var(--orange);
            background: rgba(247, 127, 0, 0.15);
        }

        .candidate-card.leader {
            border-color: var(--orange);
        }

        .score-badge {
            position: absolute;
            top: 0.4rem;
            left: 0.4rem;
            padding: 0.15rem 0.4rem;
            font-size: 0.55rem;
            font-weight: 700;
            letter-spacing: 0.03em;
            border-radius: 3px;
            color: #fff;
        }
        .score-badge.score-high { background: var(--red); }
        .score-badge.score-mid { background: var(--orange); }
        .score-badge.score-low { background: #666; }

        .details-indicator {
            text-align: center;
            color: var(--orange);
            font-size: 0.8rem;
            margin-top: 0.5rem;
            opacity: 0.7;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .your-vote-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--orange);
            color: var(--black);
            padding: 0.2rem 0.5rem;
            font-size: 0.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        .candidate-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 0.75rem;
            border-radius: 6px;
            background: white;
            padding: 6px;
        }

        .candidate-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.2rem;
            line-height: 1.1;
            color: var(--white);
        }

        .candidate-parent {
            font-size: 0.55rem;
            opacity: 0.4;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .vote-bar {
            height: 3px;
            background: rgba(255,255,255,0.1);
            margin-bottom: 0.3rem;
        }

        .vote-fill {
            height: 100%;
            background: var(--orange);
            transition: width 0.3s ease;
        }

        .vote-count {
            font-size: 0.65rem;
            opacity: 0.6;
        }

        /* Secondary Button */
        .secondary-btn {
            padding: 1rem 2rem;
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255,255,255,0.4);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .secondary-btn:hover {
            border-color: var(--white);
            background: rgba(255,255,255,0.05);
        }

        /* Don't Have It Section */
        .dont-have-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            text-align: left;
        }

        .dont-have-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: var(--orange);
        }

        .dont-have-list {
            list-style: none;
            padding: 0;
        }

        .dont-have-list li {
            font-size: 0.8rem;
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            opacity: 0.8;
        }

        .dont-have-list li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--orange);
        }

        /* After Week Section */
        .after-week-section {
            padding: 2rem;
            text-align: center;
        }

        .after-week-message {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--orange);
        }

        /* Phase Header */
        .phase-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        /* Debug Panel */
        .debug-panel {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.95);
            border: 2px solid var(--orange);
            padding: 1rem;
            font-size: 0.75rem;
            z-index: 9999;
            min-width: 220px;
        }

        .debug-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--orange);
            margin-bottom: 0.75rem;
        }

        .debug-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .debug-row select {
            background: var(--black);
            color: var(--white);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.25rem 0.5rem;
            font-family: inherit;
            font-size: 0.7rem;
        }

        .debug-row button {
            background: transparent;
            color: var(--white);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.25rem 0.5rem;
            font-family: inherit;
            font-size: 0.65rem;
            cursor: pointer;
            flex: 1;
        }

        .debug-row button:hover {
            background: rgba(255,255,255,0.1);
        }

        #debug-current-phase {
            color: var(--orange);
            font-weight: bold;
        }

        /* Now/Go Badge for Drop Time */
        .now-badge {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            color: var(--red);
            text-shadow: 0 0 30px rgba(230, 57, 70, 0.5);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Salted Section */
        .salted-section {
            padding: 3rem 1rem;
            text-align: center;
        }

        .salted-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            opacity: 0.4;
            margin-bottom: 1rem;
        }

        .salted-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
        }

        .salted-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 0.5rem 1rem;
            position: relative;
        }

        .salted-item::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0.5rem;
            right: 0.5rem;
            height: 1px;
            background: var(--red);
            opacity: 0.6;
        }

        .salted-stats {
            font-size: 0.6rem;
            opacity: 0.5;
            margin-top: 0.25rem;
        }

        .candidate-card.winner {
            border-color: var(--red);
            background: rgba(230, 57, 70, 0.1);
        }

        .salted-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            opacity: 0.4;
        }

        .salted-empty {
            font-size: 0.7rem;
            opacity: 0.3;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .footer-badge {
            font-size: 0.55rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.4;
        }

        /* Story Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .story-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            padding: 2rem 0;
        }

        .story-preview {
            width: 270px;
            height: 480px;
            border: 2px solid var(--white);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .story-content {
            width: 100%;
            height: 100%;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(180deg, #0a0a0a 0%, #1a0808 40%, #2a0a0a 60%, #0a0a0a 100%);
            position: relative;
            overflow: hidden;
        }

        .story-content::before {
            content: 'SALT';
            position: absolute;
            font-family: 'Black Ops One', cursive;
            font-size: 8rem;
            color: rgba(230, 57, 70, 0.04);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            pointer-events: none;
            letter-spacing: 0.1em;
        }

        .story-header {
            text-align: center;
        }

        .story-logo {
            font-family: 'Black Ops One', cursive;
            font-size: 3.2rem;
            color: var(--salt);
            text-shadow: 2px 2px 0 var(--red), 0 0 30px rgba(230, 57, 70, 0.3);
            letter-spacing: 0.08em;
        }

        .story-acronym {
            font-size: 0.45rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            opacity: 0.6;
            margin-top: 0.25rem;
        }

        .story-main {
            text-align: center;
        }

        .story-week {
            font-size: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0.5;
            margin-bottom: 0.25rem;
        }

        .story-action {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
        }

        .story-target {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.2rem;
            color: var(--red);
            letter-spacing: 0.03em;
            line-height: 1;
            margin-bottom: 0.75rem;
            text-shadow: 0 0 40px rgba(230, 57, 70, 0.4);
        }

        .story-datetime {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            color: var(--orange);
            margin-bottom: 0.25rem;
        }

        .story-timezone {
            font-size: 0.5rem;
            opacity: 0.5;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .story-committed {
            margin-top: 1rem;
            padding: 0.4rem 0.75rem;
            background: rgba(230, 57, 70, 0.2);
            border: 1px solid var(--red);
            display: inline-block;
            font-size: 0.6rem;
            letter-spacing: 0.05em;
        }

        .story-footer {
            text-align: center;
        }

        .story-reason {
            font-size: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.6;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .story-url {
            font-size: 0.75rem;
            color: var(--salt);
            font-weight: 700;
        }

        .story-hashtag {
            font-size: 0.5rem;
            margin-top: 0.5rem;
            opacity: 0.5;
        }

        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: 100%;
            max-width: 270px;
        }

        .modal-actions-row {
            display: flex;
            gap: 0.75rem;
        }

        .modal-btn {
            flex: 1;
            padding: 0.875rem 1rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            border: 2px solid var(--white);
            transition: all 0.15s ease;
            text-align: center;
        }

        .modal-btn.primary {
            background: var(--white);
            color: var(--black);
        }

        .modal-btn.secondary {
            background: transparent;
            color: var(--white);
        }

        .modal-btn.close-btn {
            background: transparent;
            color: var(--white);
            opacity: 0.6;
            font-size: 0.9rem;
            padding: 0.5rem;
            border: none;
        }

        .modal-btn:hover {
            transform: scale(1.03);
        }

        .modal-btn.close-btn:hover {
            opacity: 1;
            transform: none;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(-150%);
            background: var(--salt);
            color: var(--black);
            padding: 1rem 2rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            transition: transform 0.3s ease;
            z-index: 3000;
            text-align: center;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.error {
            background: var(--red);
            color: var(--white);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--black);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--salt);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @media (max-width: 600px) {
            .container {
                padding: 0.75rem;
            }

            .header {
                padding: 1.25rem 0;
            }

            .logo {
                font-size: clamp(3.5rem, 12vw, 5rem);
                text-shadow: 3px 3px 0 var(--red);
            }

            .acronym {
                font-size: 0.6rem;
                letter-spacing: 0.15em;
            }

            .mission {
                padding: 1.25rem 0.5rem;
            }

            .mission-text {
                font-size: 0.8rem;
                line-height: 1.6;
            }

            .mission-tagline {
                font-size: 1.3rem;
            }

            .mission-steps {
                font-size: 1.1rem;
            }

            .this-week {
                padding: 1.5rem 0.5rem;
            }

            .drop-info {
                flex-direction: column;
                gap: 1rem;
            }

            .action-buttons {
                flex-direction: column;
                width: 100%;
            }

            .commit-btn, .share-btn {
                width: 100%;
                padding: 0.85rem 1.5rem;
                font-size: 1.2rem;
            }

            .vote-section {
                padding: 1.5rem 0.5rem;
            }

            .vote-title {
                font-size: 1.8rem;
            }

            .candidates-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }

            .candidate-card {
                padding: 1rem 0.6rem;
            }

            .candidate-logo {
                width: 36px;
                height: 36px;
                margin-bottom: 0.5rem;
            }

            .candidate-name {
                font-size: 0.75rem;
            }

            .candidate-parent {
                font-size: 0.45rem;
            }

            .score-badge {
                font-size: 0.45rem;
                padding: 0.1rem 0.3rem;
            }

            .why-box, .how-box {
                padding: 0.85rem;
            }

            .why-title, .how-title {
                font-size: 0.9rem;
            }

            .why-list li, .how-steps li {
                font-size: 0.7rem;
            }

            .vote-summary {
                padding: 0.85rem 1rem;
            }

            .vote-summary-text {
                font-size: 0.65rem;
            }

            .vote-comparison {
                font-size: 0.5rem;
                gap: 0.75rem;
            }

            .cancel-preview {
                padding: 0.85rem 1rem;
            }

            .target-name {
                font-size: 2.5rem;
            }

            .salted-section {
                padding: 1.5rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="loading-text">LOADING...</div>
    </div>

    <div class="grain"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">SALT</div>
            <div class="acronym">Subscribers Against Lawless Tyranny</div>
        </header>

        <!-- Countdown to Friday Noon EST -->
        <div class="countdown-bar" id="countdown-bar">
            <div class="countdown-label">NEXT CANCEL FRIDAY</div>
            <div class="countdown-timer" id="countdown-timer"></div>
        </div>

        <!-- Mission Statement -->
        <section class="mission">
            <div class="mission-tagline">Each week, we vote. One target. Each Friday at noon EST, we cancel. #CancelFriday</div>
            <p class="mission-text">
                The government doesn't hear us. Corporations will. <strong>Thousands unsubscribing on one day is a crisis.</strong>
            </p>
            <p class="mission-text" style="margin-top: 0.75rem;">
                These companies profit from deportations, build ICE infrastructure, and bankroll Trump. We have receipts.
            </p>
            <div class="mission-steps">Vote â†’ Commit â†’ Cancel â†’ Repeat</div>
            <div class="mission-tagline" style="margin-top: 1rem; color: var(--orange);">We can live without streaming. They can't live without us.</div>
        </section>

        <!-- PHASE 1: VOTING (Monday-Thursday) -->
        <section class="vote-section" id="phase-voting">
            <div class="phase-header">
                <div class="vote-title" id="main-title">CHOOSE YOUR TARGET</div>
                <div class="vote-subtitle" id="main-subtitle">
                    Pick this week's target. Click to see the receipts. <a href="why.html" style="color: var(--orange); text-decoration: none;">Why these companies? â†’</a>
                </div>
            </div>

            <div class="candidates-grid" id="candidates-grid">
                <!-- Candidates loaded dynamically -->
            </div>

            <div class="vote-count-total">
                <span id="total-votes">0</span> total votes cast
            </div>
        </section>

        <!-- PHASE 2 & 3: TARGET INFO SECTION -->
        <section class="this-week" id="target-section">
            <div class="week-badge" id="week-badge">WEEK 1</div>

            <!-- Dynamic header based on phase -->
            <div class="section-label" id="target-label">Select a company above to see why</div>
            <div class="current-target" id="current-target"></div>
            <div class="current-parent" id="current-parent"></div>

            <!-- Why This Company -->
            <div class="why-box" id="why-box" style="display: none;"></div>

            <!-- How To Cancel -->
            <div class="how-box" id="how-box" style="display: none;"></div>

            <!-- Countdown Section -->
            <div class="drop-info" id="drop-info" style="display: none;">
                <div class="drop-datetime">
                    <div class="drop-label" id="drop-label">Cancellation time</div>
                    <div class="drop-date" id="drop-date">FRIDAY, JAN 31 â€¢ 12:00 PM EST</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-label">Countdown</div>
                    <div class="countdown" id="countdown">--:--:--:--</div>
                </div>
            </div>

            <!-- Participants Count -->
            <div class="participants-count" id="participants-section" style="display: none;">
                <div class="participants-number" id="participants-count">0</div>
                <div class="participants-label" id="participants-label">people committed</div>
            </div>

            <!-- Action Buttons - changes based on phase -->
            <div class="action-buttons" id="action-buttons" style="display: none;">
                <!-- Phase 1: Vote button -->
                <button class="commit-btn" id="vote-btn" style="display: none;">VOTE FOR THIS TARGET</button>

                <!-- Phase 2: I'm In + Don't Have It + Share -->
                <button class="commit-btn" id="commit-btn" style="display: none;">I'M IN</button>
                <button class="secondary-btn" id="dont-have-btn" style="display: none;">DON'T HAVE IT?</button>

                <!-- Phase 3: I Did It -->
                <button class="commit-btn" id="confirm-btn" style="display: none;">I DID IT</button>

                <!-- Always available after voting/committing -->
                <button class="share-btn" id="share-btn" onclick="openStoryModal()" style="display: none;">SHARE THE MOVEMENT</button>
            </div>

            <!-- Don't Have It expansion -->
            <div class="dont-have-section" id="dont-have-section" style="display: none;">
                <div class="dont-have-title">Other ways to help:</div>
                <ul class="dont-have-list">
                    <li>Share the campaign on social media</li>
                    <li>Help someone else cancel their subscription</li>
                    <li>Contact the company and tell them why you're disappointed</li>
                </ul>
            </div>

            <!-- Status note -->
            <p class="commit-note" id="status-note" style="display: none;"></p>

            <!-- Post-vote summary -->
            <div class="vote-summary" id="vote-summary" style="display: none;">
                <div class="vote-summary-text" id="vote-summary-text"></div>
                <div class="vote-comparison" id="vote-comparison"></div>
                <button class="change-vote-btn" id="change-vote-btn" style="display: none;">Change my vote</button>
            </div>

            <!-- Cancel preview -->
            <div class="cancel-preview" id="cancel-preview" style="display: none;">
                <div class="cancel-preview-title">How to cancel (preview)</div>
                <ol class="cancel-preview-steps" id="cancel-preview-steps"></ol>
            </div>
        </section>

        <!-- Salted Section -->
        <section class="salted-section">
            <div class="salted-title">Already Salted</div>
            <div class="salted-list" id="salted-list">
                <div class="salted-empty">Week 1 â€” You're here at the beginning</div>
            </div>
        </section>

        <!-- After Week Message -->
        <section class="after-week-section" id="after-week-section" style="display: none;">
            <div class="after-week-message">Next week's voting opens Monday</div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-badge" id="mode-badge">ðŸ”’ Anonymous voting â€¢ No IP addresses or personal data recorded</div>
        </footer>

        <!-- Debug Panel (Demo Mode Only) -->
        <div class="debug-panel" id="debug-panel" style="display: none;">
            <div class="debug-title">ðŸ§ª DEMO CONTROLS</div>
            <div class="debug-row">
                <span>Phase:</span>
                <select id="debug-phase" onchange="setDebugPhase(this.value)">
                    <option value="auto">Auto (Real Time)</option>
                    <option value="VOTING">Phase 1: Voting</option>
                    <option value="TARGET_LOCKED">Phase 2: Target Locked</option>
                    <option value="DROP_TIME">Phase 3: Drop Time</option>
                    <option value="AFTER">Phase 4: After</option>
                </select>
            </div>
            <div class="debug-row">
                <span>Current:</span>
                <span id="debug-current-phase">â€”</span>
            </div>
            <div class="debug-row">
                <button onclick="resetDemoData()">Reset All Data</button>
                <button onclick="addDemoVotes()">Add Demo Votes</button>
            </div>
        </div>
    </div>

    <!-- Story Modal -->
    <div class="modal" id="story-modal">
        <div class="story-container">
            <div class="story-preview">
                <div class="story-content" id="story-content">
                    <div class="story-header">
                        <div class="story-logo">SALT</div>
                        <div class="story-acronym">Subscribers Against Lawless Tyranny</div>
                    </div>
                    <div class="story-main">
                        <div class="story-week" id="story-week">WEEK 1</div>
                        <div class="story-action" id="story-action">I'm canceling</div>
                        <div class="story-target" id="story-target">AMAZON PRIME</div>
                        <div class="story-datetime" id="story-datetime">FRI JAN 31 â€¢ 12PM EST</div>
                        <div class="story-timezone">Together. All at once.</div>
                        <div class="story-committed" id="story-committed"></div>
                    </div>
                    <div class="story-footer">
                        <div class="story-reason">They can't afford to lose us.</div>
                        <div class="story-url">cancelfriday.com</div>
                        <div class="story-hashtag">#CANCELFRIDAY #SALTTHEEARTH</div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <div class="modal-actions-row">
                    <button class="modal-btn primary" onclick="saveStory()">Save Image</button>
                    <button class="modal-btn secondary" onclick="copyStory()">Copy</button>
                </div>
                <button class="modal-btn close-btn" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const SUPABASE_URL = 'https://nwrehybllhhqocyxtanf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53cmVoeWJsbGhocW9jeXh0YW5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NzAxNjksImV4cCI6MjA4NTE0NjE2OX0.EHFci8UuWxriFBA8kfluJewDlGgjcsNm2s6oMWnchwg';
        const DEMO_MODE = false;
        let supabaseClient = null;

        // Initialize Supabase client if configured
        if (!DEMO_MODE && typeof window.supabase !== 'undefined') {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        }

        // ============================================
        // FINGERPRINT
        // ============================================
        function generateFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('salt', 2, 2);
            const canvasData = canvas.toDataURL();

            const data = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                new Date().getTimezoneOffset(),
                canvasData.slice(-50)
            ].join('|');

            let hash = 0;
            for (let i = 0; i < data.length; i++) {
                const char = data.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(36);
        }

        const FINGERPRINT = generateFingerprint();

        // ============================================
        // WEEK DATA (Edit this each week)
        // ============================================
        const WEEK_DATA = {
            week_number: 1,
            // Week starts Monday 12:00am EST, voting ends Thursday 11:59pm EST
            // Target locked Friday 12:00am-11:59am EST, Drop time Friday 12:00pm EST
            week_start: '2026-02-02T05:00:00Z', // Monday 12am EST = 5am UTC
            voting_end: '2026-02-06T04:59:00Z', // Thursday 11:59pm EST = Friday 4:59am UTC
            target_locked: '2026-02-06T05:00:00Z', // Friday 12:00am EST = 5am UTC
            drop_time: '2026-02-06T17:00:00Z', // Friday 12pm EST = 5pm UTC
            week_end: '2026-02-07T05:00:00Z' // Saturday 12am EST = 5am UTC
        };

        // ============================================
        // COUNTDOWN TO DROP TIME
        // ============================================
        function updateCountdown() {
            const now = new Date();
            const target = new Date(WEEK_DATA.drop_time);
            const diff = target - now;

            const el = document.getElementById('countdown-timer');
            if (!el) return;

            if (diff <= 0) {
                // Past drop time - show "CANCEL NOW" for 1 hour, then count to next week
                if (diff > -3600000) {
                    el.innerHTML = '<span class="countdown-done">CANCEL NOW</span>';
                } else {
                    el.innerHTML = '<span class="countdown-done">IN PROGRESS</span>';
                }
                return;
            }

            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            el.innerHTML =
                `<span class="cd-unit">${d}<span class="cd-label">days</span></span>` +
                `<span class="cd-sep">:</span>` +
                `<span class="cd-unit">${String(h).padStart(2,'0')}<span class="cd-label">hrs</span></span>` +
                `<span class="cd-sep">:</span>` +
                `<span class="cd-unit">${String(m).padStart(2,'0')}<span class="cd-label">min</span></span>` +
                `<span class="cd-sep">:</span>` +
                `<span class="cd-unit">${String(s).padStart(2,'0')}<span class="cd-label">sec</span></span>`;
        }
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // ============================================
        // PHASE DETECTION
        // ============================================
        // Phase 1: VOTING - Monday 12am to Thursday 11:59pm
        // Phase 2: TARGET_LOCKED - Friday 12am to 11:59am
        // Phase 3: DROP_TIME - Friday 12pm onwards
        // Phase 4: AFTER - Saturday onwards (show results)

        let debugPhaseOverride = null; // Set to 'VOTING', 'TARGET_LOCKED', 'DROP_TIME', or 'AFTER' to override

        function getCurrentPhase() {
            // Check for debug override
            if (debugPhaseOverride) {
                return debugPhaseOverride;
            }

            const now = new Date();
            const votingEnd = new Date(WEEK_DATA.voting_end);
            const targetLocked = new Date(WEEK_DATA.target_locked);
            const dropTime = new Date(WEEK_DATA.drop_time);
            const weekEnd = new Date(WEEK_DATA.week_end);

            if (now < votingEnd) {
                return 'VOTING';
            } else if (now < dropTime) {
                return 'TARGET_LOCKED';
            } else if (now < weekEnd) {
                return 'DROP_TIME';
            } else {
                return 'AFTER';
            }
        }

        // Debug functions
        function setDebugPhase(phase) {
            debugPhaseOverride = phase === 'auto' ? null : phase;
            render();
            updateDebugPanel();
        }

        function resetDemoData() {
            localStorage.removeItem('salt_demo_v9');
            userVotedFor = null;
            userCommittedIn = false;
            userConfirmed = false;
            selectedCandidate = null;
            loadData();
            showToast('Demo data reset!');
        }

        function addDemoVotes() {
            const demo = getDemoData();
            demo.candidates.forEach(c => {
                c.vote_count += Math.floor(Math.random() * 50) + 10;
            });
            demo.commitment_count += Math.floor(Math.random() * 100) + 50;
            demo.confirmed_count = (demo.confirmed_count || 0) + Math.floor(Math.random() * 50) + 20;
            saveDemoData(demo);
            candidates = demo.candidates;
            currentWeek.commitment_count = demo.commitment_count;
            currentWeek.confirmed_count = demo.confirmed_count;
            winningCandidate = getWinner();
            render();
            showToast('Added demo votes!');
        }

        function updateDebugPanel() {
            const panel = document.getElementById('debug-panel');
            const currentPhaseEl = document.getElementById('debug-current-phase');
            if (panel && DEMO_MODE) {
                panel.style.display = 'block';
                if (currentPhaseEl) {
                    currentPhaseEl.textContent = getCurrentPhase();
                }
            }
        }

        const CANDIDATES = [
            {
                id: 'prime',
                name: 'Amazon Prime',
                parent: 'Amazon.com Inc.',
                logo: 'https://logo.clearbit.com/amazon.com',
                score: 9,
                why: {
                    title: 'Why Amazon?',
                    reasons: [
                        { text: 'Jeff Bezos dined with Trump at Mar-a-Lago in December 2024, joined by Elon Musk', source: 'https://www.washingtonpost.com/politics/2024/12/19/trump-bezos-musk-dinner/' },
                        { text: 'Amazon Web Services is the backbone of ICE\'s surveillance and deportation infrastructure â€” CBP has 62% of its systems on AWS', source: 'https://investigate.afsc.org/company/amazon' },
                        { text: 'AWS hosts ICE\'s biometric database (HART) containing iris scans, voiceprints, and DNA of hundreds of millions of people', source: 'https://www.technologyreview.com/2018/10/22/139639/amazon-is-the-invisible-backbone-behind-ices-immigration-crackdown/' },
                        { text: 'Donated $1 million to Trump\'s 2025 inauguration fund, plus streaming the inauguration on Prime Video', source: 'https://www.foxbusiness.com/politics/amazon-plans-make-1-million-donation-trump-inaugural-fund-bezos-visit-mar-a-lago' },
                        { text: 'Bezos personally killed the Washington Post\'s planned endorsement of Kamala Harris 11 days before the election', source: 'https://www.npr.org/2024/10/28/nx-s1-5168416/washington-post-bezos-endorsement-president-cancellations-resignations' },
                        { text: 'Amazon pitched its facial recognition technology (Rekognition) directly to ICE for mass surveillance', source: 'https://www.thedailybeast.com/amazon-pushes-ice-to-buy-its-face-recognition-surveillance-tech/' }
                    ]
                },
                how: {
                    title: 'How to Cancel Amazon Prime',
                    steps: [
                        'Go to Amazon.com â†’ Account & Lists',
                        'Click "Prime Membership"',
                        'Click "Update, cancel and more"',
                        'Select "End membership"',
                        'Confirm cancellation (ignore their offers and discounts)'
                    ],
                    link: 'https://www.amazon.com/mc?ref_=nav_AccountFlyout_mc',
                    linkText: 'Go to Amazon Prime Settings â†’'
                }
            },
            {
                id: 'youtube',
                name: 'YouTube Premium',
                parent: 'Alphabet Inc. (Google)',
                logo: 'https://logo.clearbit.com/youtube.com',
                score: 8,
                why: {
                    title: 'Why YouTube/Google?',
                    reasons: [
                        { text: 'Google Cloud is deploying AI-powered surveillance cameras along the US-Mexico border for CBP in 2025', source: 'https://theintercept.com/2025/04/03/google-cbp-ai-border-surveillance-ibm-equitus/' },
                        { text: 'Google used 28+ third-party shell companies to secretly sell cloud services to ICE and CBP while publicly claiming they weren\'t', source: 'https://www.techdirt.com/2021/10/13/google-amazon-microsoft-are-using-third-party-companies-to-sell-surveillance-tech-to-ice-cbp/' },
                        { text: 'Google fired employees who raised concerns about the company\'s work with CBP', source: 'https://www.hstoday.us/subject-matter-areas/border-security/tensions-rise-at-google-amid-trend-of-employees-demanding-ice-cbp-contracts-be-nixed/' },
                        { text: 'CEO Sundar Pichai met with Trump at Mar-a-Lago in December 2024', source: 'https://www.washingtonpost.com/technology/2024/12/12/zuckerberg-bezos-pichai-trump/' },
                        { text: '1,495 Google employees signed a petition demanding the company stop working with ICE and CBP â€” Google refused', source: 'https://www.cnbc.com/2019/08/19/google-employees-implore-leaders-to-stop-working-with-us-bcp-ice.html' }
                    ]
                },
                how: {
                    title: 'How to Cancel YouTube Premium',
                    steps: [
                        'Go to youtube.com/paid_memberships',
                        'Click "Manage Membership"',
                        'Click "Deactivate"',
                        'Confirm cancellation'
                    ],
                    link: 'https://www.youtube.com/paid_memberships',
                    linkText: 'Go to YouTube Memberships â†’'
                }
            },
            {
                id: 'appletv',
                name: 'Apple TV+',
                parent: 'Apple Inc.',
                logo: 'https://logo.clearbit.com/apple.com',
                score: 7,
                why: {
                    title: 'Why Apple?',
                    reasons: [
                        { text: 'Tim Cook dined with Trump at Mar-a-Lago in December 2024, continuing their "warm relationship" from Trump\'s first term', source: 'https://9to5mac.com/2024/12/13/cook-trump-mar-a-lago-meeting/' },
                        { text: 'Cook called Trump to ask for help fighting EU fines, signaling willingness to seek favors from the administration', source: 'https://appleinsider.com/articles/24/12/14/tim-cook-rumored-to-be-meeting-with-donald-trump-for-dinner-on-friday' },
                        { text: 'Apple has remained completely silent on ICE deportations and immigration enforcement', source: null },
                        { text: 'Cook met with Trump alongside 80+ CEOs before the election to discuss potential business-friendly policies', source: 'https://appleinsider.com/articles/24/12/14/tim-cook-rumored-to-be-meeting-with-donald-trump-for-dinner-on-friday' }
                    ]
                },
                how: {
                    title: 'How to Cancel Apple TV+',
                    steps: [
                        'On iPhone/iPad: Settings â†’ Your Name â†’ Subscriptions',
                        'Select Apple TV+',
                        'Tap "Cancel Subscription"',
                        'Or on web: tv.apple.com â†’ Account â†’ Settings â†’ Subscriptions'
                    ],
                    link: 'https://support.apple.com/en-us/HT202039',
                    linkText: 'Apple Subscription Help â†’'
                }
            },
            {
                id: 'disney',
                name: 'Disney+',
                parent: 'The Walt Disney Company',
                logo: 'https://logo.clearbit.com/disney.com',
                score: 6,
                why: {
                    title: 'Why Disney?',
                    reasons: [
                        { text: 'ABC News (Disney subsidiary) paid $15 million to Trump\'s presidential library to settle a defamation lawsuit â€” widely seen as "bending the knee"', source: 'https://www.cnn.com/2024/12/19/business/disney-iger-abc-trump-nightcap' },
                        { text: 'CEO Bob Iger â€” a longtime Democratic donor â€” refused to donate to Kamala Harris in 2024, staying neutral for the first time', source: 'https://www.avclub.com/disney-bob-iger-didnt-donate-presidential-election-2024' },
                        { text: 'Disney removed a transgender storyline from a Pixar series days after Trump\'s election victory', source: 'https://www.cnn.com/2024/12/19/business/disney-iger-abc-trump-nightcap' },
                        { text: 'Iger met with Trump in the White House to discuss Disney\'s Abu Dhabi theme park plans', source: 'https://deadline.com/2025/05/trump-bob-iger-disney-abu-dhabi-1236404813/' },
                        { text: 'Disney pulled Jimmy Kimmel\'s show after Trump and FCC pressure over critical coverage', source: 'https://www.huffpost.com/entry/disney-bob-iger-trump-jimmy-kimmel_n_68cc16dae4b0aa8d99fe9244' },
                        { text: 'Marvel chairman Isaac Perlmutter donated $10.5 million to pro-Trump Super PAC in 2020', source: 'https://www.nationalreview.com/corner/the-disney-executive-who-donated-10-million-to-help-trump-in-2020/' }
                    ]
                },
                how: {
                    title: 'How to Cancel Disney+',
                    steps: [
                        'Go to Disneyplus.com',
                        'Click Profile â†’ Account',
                        'Select your subscription',
                        'Click "Cancel Subscription"',
                        'Confirm cancellation'
                    ],
                    link: 'https://www.disneyplus.com/account',
                    linkText: 'Go to Disney+ Account â†’'
                }
            },
            {
                id: 'hulu',
                name: 'Hulu',
                parent: 'The Walt Disney Company',
                logo: 'https://logo.clearbit.com/hulu.com',
                score: 6,
                why: {
                    title: 'Why Hulu?',
                    reasons: [
                        { text: 'Owned by Disney â€” same parent company that paid $15 million to Trump\'s library and capitulated to administration pressure', source: 'https://www.cnn.com/2024/12/19/business/disney-iger-abc-trump-nightcap' },
                        { text: 'Profits from content featuring immigrant stories while parent company stays silent on deportations', source: null },
                        { text: 'Your subscription dollars flow to the same company that pulled Jimmy Kimmel for criticizing conservatives', source: 'https://www.huffpost.com/entry/disney-bob-iger-trump-jimmy-kimmel_n_68cc16dae4b0aa8d99fe9244' }
                    ]
                },
                how: {
                    title: 'How to Cancel Hulu',
                    steps: [
                        'Go to Hulu.com',
                        'Click your Profile â†’ Account',
                        'Click "Cancel Your Subscription"',
                        'Confirm cancellation'
                    ],
                    link: 'https://secure.hulu.com/account',
                    linkText: 'Go to Hulu Account â†’'
                }
            },
            {
                id: 'spotify',
                name: 'Spotify Premium',
                parent: 'Spotify AB',
                logo: 'https://logo.clearbit.com/spotify.com',
                score: 5,
                why: {
                    title: 'Why Spotify?',
                    reasons: [
                        { text: 'Gave Joe Rogan a $250 million deal â€” he endorsed Trump in 2024 and hosted him for a 3-hour interview before the election', source: 'https://www.nbcnews.com/pop-culture/pop-culture-news/joe-rogan-criticizes-ice-tactics-podcast-rcna253931' },
                        { text: 'Rogan\'s podcast has 20+ million subscribers and helped persuade young men to vote for Trump', source: 'https://www.nbcnews.com/pop-culture/pop-culture-news/joe-rogan-criticizes-ice-tactics-podcast-rcna253931' },
                        { text: 'Spotify refused to drop Rogan despite employee protests over his use of racial slurs and misinformation', source: 'https://www.npr.org/2022/02/07/1078774392/spotifys-ceo-says-the-company-isnt-ready-to-part-ways-with-joe-rogan' },
                        { text: 'NOTE: Rogan has recently criticized ICE as "the Gestapo" â€” but Spotify still profited from platforming his Trump endorsement', source: 'https://www.nbcnews.com/pop-culture/pop-culture-news/joe-rogan-criticizes-ice-tactics-podcast-rcna253931' }
                    ]
                },
                how: {
                    title: 'How to Cancel Spotify Premium',
                    steps: [
                        'Go to Spotify.com/account',
                        'Click "Subscription" in the left menu',
                        'Click "Change or Cancel"',
                        'Select "Cancel Premium"',
                        'Confirm cancellation'
                    ],
                    link: 'https://www.spotify.com/account/subscription/',
                    linkText: 'Go to Spotify Account â†’'
                }
            },
            {
                id: 'uber',
                name: 'Uber One',
                parent: 'Uber Technologies',
                logo: 'https://logo.clearbit.com/uber.com',
                score: 5,
                why: {
                    title: 'Why Uber?',
                    reasons: [
                        { text: 'Former CEO Travis Kalanick served on Trump\'s business advisory council in 2017 before resigning after #DeleteUber boycotts', source: 'https://money.cnn.com/2017/08/29/technology/business/uber-ceo-trump/index.html' },
                        { text: 'Current CEO Dara Khosrowshahi (an Iranian refugee) has softened his Trump criticism, recently calling the administration "pro-growth, pro-business"', source: 'https://www.cbsnews.com/news/uber-ceo-dara-khosrowshahi-on-being-behind-the-wheel/' },
                        { text: 'Uber spent $200+ million fighting Proposition 22 to deny gig workers (many immigrants) basic employment protections', source: null },
                        { text: 'Exploits immigrant labor force â€” many drivers are immigrants working without benefits, healthcare, or job security', source: null }
                    ]
                },
                how: {
                    title: 'How to Cancel Uber One',
                    steps: [
                        'Open Uber app',
                        'Go to Account â†’ Uber One',
                        'Tap "Manage Membership"',
                        'Select "End Membership"'
                    ],
                    link: null,
                    linkText: 'Cancel in Uber app'
                }
            },
            {
                id: 'netflix',
                name: 'Netflix',
                parent: 'Netflix Inc.',
                logo: 'https://logo.clearbit.com/netflix.com',
                score: 4,
                why: {
                    title: 'Why Netflix?',
                    reasons: [
                        { text: 'Co-CEO Ted Sarandos visited Trump at Mar-a-Lago in December 2024 and had an Oval Office meeting in November 2025', source: 'https://variety.com/2024/biz/news/ted-sarandos-donald-trump-netflix-mar-a-lago-1236251144/' },
                        { text: 'Sarandos is seeking Trump\'s approval for Netflix\'s $82.7 billion Warner Bros acquisition', source: 'https://variety.com/2025/biz/news/netflix-ted-sarandos-white-house-meeting-trump-warner-bros-deal-1236602831/' },
                        { text: 'Despite releasing critical content like "Immigration Nation" (which Trump tried to block), Netflix leadership is now courting the administration', source: 'https://www.thedailybeast.com/inside-netflixs-immigration-nation-the-horrifying-ice-documentary-trump-doesnt-want-you-to-see/' },
                        { text: 'Former CEO Reed Hastings called Trump\'s immigration ban "anti-American" â€” but new leadership has changed course', source: 'https://techcrunch.com/2017/05/31/netflixs-hastings-trumps-immigration-ban-anti-american/' }
                    ]
                },
                how: {
                    title: 'How to Cancel Netflix',
                    steps: [
                        'Go to Netflix.com',
                        'Click your Profile â†’ Account',
                        'Click "Cancel Membership"',
                        'Confirm cancellation'
                    ],
                    link: 'https://www.netflix.com/cancelplan',
                    linkText: 'Go to Netflix Account â†’'
                }
            },
            {
                id: 'paramount',
                name: 'Paramount+',
                parent: 'Paramount Global',
                logo: 'https://logo.clearbit.com/paramountplus.com',
                score: 4,
                why: {
                    title: 'Why Paramount?',
                    reasons: [
                        { text: 'CBS News (Paramount subsidiary) killed a 60 Minutes segment on ICE deportations to El Salvador prisons â€” it only aired in Canada', source: 'https://deadline.com/2026/01/trump-against-netflix-warner-bros-deal-1236679318/' },
                        { text: 'New CBS News editor axed the already-greenlit segment claiming it needed to be "fair" to the White House', source: 'https://deadline.com/2026/01/trump-against-netflix-warner-bros-deal-1236679318/' },
                        { text: 'Owner Shari Redstone makes political donations across the spectrum, prioritizing business relationships over principles', source: null }
                    ]
                },
                how: {
                    title: 'How to Cancel Paramount+',
                    steps: [
                        'Go to ParamountPlus.com',
                        'Click Profile â†’ Account â†’ Subscription',
                        'Click "Cancel Subscription"',
                        'Confirm'
                    ],
                    link: 'https://www.paramountplus.com/account/',
                    linkText: 'Go to Paramount+ Account â†’'
                }
            },
            {
                id: 'max',
                name: 'Max',
                parent: 'Warner Bros. Discovery',
                logo: 'https://logo.clearbit.com/max.com',
                score: 4,
                why: {
                    title: 'Why Max?',
                    reasons: [
                        { text: 'Warner Bros. Discovery CEO David Zaslav has maintained cozy relationships with political establishment on both sides', source: null },
                        { text: 'CNN (same parent company) has been criticized for "both-sides" coverage that normalizes extreme immigration policies', source: null },
                        { text: 'No public statement against ICE actions or support for immigrant communities', source: null }
                    ]
                },
                how: {
                    title: 'How to Cancel Max',
                    steps: [
                        'Go to Max.com',
                        'Click Profile â†’ Settings â†’ Subscription',
                        'Click "Manage Subscription"',
                        'Select "Cancel Subscription"',
                        'Confirm'
                    ],
                    link: 'https://www.max.com/settings/subscription',
                    linkText: 'Go to Max Settings â†’'
                }
            },
            {
                id: 'doordash',
                name: 'DashPass',
                parent: 'DoorDash Inc.',
                logo: 'https://logo.clearbit.com/doordash.com',
                score: 3,
                why: {
                    title: 'Why DoorDash?',
                    reasons: [
                        { text: 'Exploits gig workers â€” many Dashers are immigrants working without benefits, sick leave, or job security', source: null },
                        { text: 'Spent millions lobbying against worker protection laws like Proposition 22 in California', source: null },
                        { text: 'No public stance on immigration despite relying heavily on immigrant labor for deliveries', source: null }
                    ]
                },
                how: {
                    title: 'How to Cancel DashPass',
                    steps: [
                        'Open DoorDash app',
                        'Go to Account â†’ DashPass',
                        'Tap "Manage DashPass"',
                        'Select "End subscription"'
                    ],
                    link: 'https://help.doordash.com/consumers/s/article/DashPass-Subscription',
                    linkText: 'DashPass Help â†’'
                }
            },
            {
                id: 'chatgpt',
                name: 'ChatGPT Plus',
                parent: 'OpenAI',
                logo: 'https://logo.clearbit.com/openai.com',
                score: 8,
                why: {
                    title: 'Why OpenAI?',
                    reasons: [
                        { text: 'Sam Altman personally donated $1 million to Trump\'s 2025 inauguration fund', source: 'https://www.foxbusiness.com/media/openai-ceo-sam-altman-donate-1-million-trumps-inaugural-fund' },
                        { text: 'Altman praised Trump at a White House dinner: "Thank you for being such a pro-business, pro-innovation president... this wouldn\'t be happening without your leadership"', source: 'https://www.yahoo.com/news/articles/sam-altman-tim-cook-other-032744872.html' },
                        { text: 'In 2016, Altman called Trump "an unacceptable threat to America" and "abusive, erratic, and prone to fits of rage" â€” now he says "President Trump will lead our country into the age of AI"', source: 'https://x.com/sama/status/787833953369464836' },
                        { text: 'OpenAI quietly deleted its ban on "military and warfare" use from its policy in January 2024, opening the door to Pentagon contracts', source: 'https://theintercept.com/2024/01/12/open-ai-military-ban-chatgpt/' },
                        { text: 'Won a $200 million Pentagon contract to develop "frontier AI" for both warfighting and military operations', source: 'https://breakingdefense.com/2025/06/openai-for-government-launches-with-200m-win-from-pentagon-cdao/' },
                        { text: 'Partnered with Anduril Industries â€” a weapons manufacturer â€” to build AI for military drone defense systems', source: 'https://www.technologyreview.com/2024/12/04/1107897/openais-new-defense-contract-completes-its-military-pivot/' },
                        { text: 'Leading the $500 billion "Stargate" AI infrastructure project announced at Trump\'s White House on his first full day in office', source: 'https://broadbandbreakfast.com/trump-hosts-tech-titans-at-press-conference-linking-energy-and-ai/' }
                    ]
                },
                how: {
                    title: 'How to Cancel ChatGPT Plus',
                    steps: [
                        'Go to chat.openai.com',
                        'Click your profile icon â†’ Settings',
                        'Select "Subscription"',
                        'Click "Cancel Plan"',
                        'Confirm cancellation'
                    ],
                    link: 'https://help.openai.com/en/articles/7039411-how-do-i-cancel-my-chatgpt-plus-subscription',
                    linkText: 'OpenAI Subscription Help â†’'
                }
            }
        ];

        const SALTED = [
            // Past targets will be added here after each week
            // Example: { name: 'Amazon Prime', week: 1, cancellations: 1247 }
        ];

        // ============================================
        // STATE
        // ============================================
        let currentWeek = { ...WEEK_DATA, commitment_count: 0, confirmed_count: 0 };
        let candidates = [];
        let userVotedFor = null;        // Which company user voted for (Phase 1)
        let userCommittedIn = false;    // User clicked "I'm In" (Phase 2)
        let userConfirmed = false;      // User clicked "I Did It" (Phase 3)
        let selectedCandidate = null;   // Currently selected for preview
        let winningCandidate = null;    // The winner after voting closes

        // ============================================
        // DEMO DATA
        // ============================================
        function getDemoData() {
            const stored = localStorage.getItem('salt_demo_v9');
            if (stored) return JSON.parse(stored);

            // Start fresh with no votes
            const initial = {
                commitment_count: 0,
                confirmed_count: 0,
                candidates: CANDIDATES.map(c => ({
                    id: c.id,
                    name: c.name,
                    parent: c.parent,
                    vote_count: 0
                })),
                votedFor: null,
                committedIn: false,
                confirmed: false
            };
            saveDemoData(initial);
            return initial;
        }

        function saveDemoData(data) {
            localStorage.setItem('salt_demo_v9', JSON.stringify(data));
        }

        function getWinner() {
            if (candidates.length === 0) return null;
            const sorted = [...candidates].sort((a, b) => b.vote_count - a.vote_count);
            return sorted[0];
        }

        // ============================================
        // LOAD DATA
        // ============================================
        async function loadData() {
            if (DEMO_MODE) {
                console.log('ðŸ§‚ SALT running in DEMO MODE - Phase:', getCurrentPhase());
                const demo = getDemoData();
                currentWeek.commitment_count = demo.commitment_count;
                currentWeek.confirmed_count = demo.confirmed_count || 0;
                candidates = demo.candidates;
                userVotedFor = demo.votedFor;
                userCommittedIn = demo.committedIn || false;
                userConfirmed = demo.confirmed || false;
                winningCandidate = getWinner();
                render();
                hideLoading();
                return;
            }

            // Supabase mode
            console.log('ðŸ§‚ SALT running with Supabase');
            try {
                // Load active week
                const { data: weekData, error: weekError } = await supabaseClient
                    .from('weeks')
                    .select('*')
                    .eq('is_active', true)
                    .single();

                if (weekError) throw weekError;

                currentWeek = {
                    ...WEEK_DATA,
                    week_number: weekData.week_number,
                    drop_time: weekData.drop_time,
                    commitment_count: weekData.participant_count
                };

                // Load candidates
                const { data: candidatesData, error: candidatesError } = await supabaseClient
                    .from('candidates')
                    .select('*')
                    .eq('week_number', weekData.week_number);

                if (candidatesError) throw candidatesError;
                candidates = candidatesData;

                // Check user's actions
                const { data: actionsData } = await supabaseClient
                    .rpc('get_user_actions', {
                        p_fingerprint_hash: FINGERPRINT,
                        p_week_number: weekData.week_number
                    });

                if (actionsData) {
                    userCommitted = actionsData.committed;
                    userVotedFor = actionsData.voted_for;
                }

                // Subscribe to realtime updates
                supabaseClient
                    .channel('salt-updates')
                    .on('postgres_changes', {
                        event: 'UPDATE',
                        schema: 'public',
                        table: 'weeks',
                        filter: `week_number=eq.${weekData.week_number}`
                    }, (payload) => {
                        currentWeek.commitment_count = payload.new.participant_count;
                        render();
                    })
                    .on('postgres_changes', {
                        event: 'UPDATE',
                        schema: 'public',
                        table: 'candidates',
                        filter: `week_number=eq.${weekData.week_number}`
                    }, (payload) => {
                        const idx = candidates.findIndex(c => c.id === payload.new.id);
                        if (idx !== -1) {
                            candidates[idx] = payload.new;
                            render();
                        }
                    })
                    .subscribe();

                render();
                hideLoading();
            } catch (err) {
                console.error('Failed to load:', err);
                showToast('Failed to connect. Running in demo mode.', true);
                // Fallback to demo mode
                const demo = getDemoData();
                currentWeek.commitment_count = demo.commitment_count;
                candidates = demo.candidates;
                userCommitted = demo.committed;
                userVotedFor = demo.votedFor;
                render();
                hideLoading();
            }
        }

        // ============================================
        // ACTIONS
        // ============================================

        // Phase 1: Select a candidate to preview
        function selectCandidate(candidateId) {
            console.log('selectCandidate called:', candidateId);
            selectedCandidate = candidateId;
            render();

            // Scroll to target section after render completes
            setTimeout(() => {
                const targetEl = document.getElementById('target-section');
                if (targetEl) {
                    targetEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        // Phase 1: Vote for a candidate
        function changeVote() {
            const phase = getCurrentPhase();
            if (phase !== 'VOTING') return;

            if (DEMO_MODE) {
                const demo = getDemoData();
                const prev = demo.candidates.find(c => c.id === userVotedFor);
                if (prev && prev.vote_count > 0) prev.vote_count--;
                demo.votedFor = null;
                saveDemoData(demo);
                candidates = demo.candidates;
            }
            // For Supabase mode, we just allow re-voting client-side;
            // the RPC should handle vote changes server-side
            userVotedFor = null;
            selectedCandidate = null;
            winningCandidate = getWinner();
            showToast('Vote cleared. Pick a new target.');
            render();
        }

        async function voteForCandidate(candidateId) {
            if (userVotedFor) {
                showToast('You already voted this week.', true);
                return;
            }

            const btn = document.getElementById('vote-btn');
            btn.disabled = true;
            btn.textContent = 'VOTING...';

            if (DEMO_MODE) {
                const demo = getDemoData();
                const candidate = demo.candidates.find(c => c.id === candidateId);
                if (candidate) {
                    candidate.vote_count++;
                    demo.votedFor = candidateId;
                    saveDemoData(demo);

                    userVotedFor = candidateId;
                    candidates = demo.candidates;
                    winningCandidate = getWinner();
                    showToast('Vote recorded! Come back Friday to cancel together.');
                    render();
                }
                return;
            }

            // Supabase mode
            try {
                const { data, error } = await supabaseClient.rpc('vote_for_candidate', {
                    p_fingerprint_hash: FINGERPRINT,
                    p_week_number: currentWeek.week_number,
                    p_candidate_id: candidateId
                });

                if (error) throw error;

                if (data.success) {
                    userVotedFor = candidateId;
                    const candidate = candidates.find(c => c.id === candidateId);
                    if (candidate) candidate.vote_count = data.new_count;
                    winningCandidate = getWinner();
                    showToast('Vote recorded! Come back Friday to cancel together.');
                    render();
                } else if (data.error === 'already_voted') {
                    showToast('You already voted this week.', true);
                }
            } catch (err) {
                console.error('Vote failed:', err);
                btn.disabled = false;
                btn.textContent = 'VOTE FOR THIS TARGET';
                showToast('Failed to vote. Try again.', true);
            }
        }

        // Phase 2: User commits to cancel ("I'm In")
        async function commitToCancel() {
            if (userCommittedIn) {
                showToast('You\'re already committed!');
                return;
            }

            const btn = document.getElementById('commit-btn');
            btn.disabled = true;
            btn.textContent = 'JOINING...';

            if (DEMO_MODE) {
                const demo = getDemoData();
                demo.commitment_count++;
                demo.committedIn = true;
                saveDemoData(demo);

                userCommittedIn = true;
                currentWeek.commitment_count = demo.commitment_count;
                showToast('You\'re in! See you Friday at noon.');
                render();
                return;
            }

            // Supabase mode
            try {
                const { data, error } = await supabaseClient.rpc('commit_to_week', {
                    p_fingerprint_hash: FINGERPRINT,
                    p_week_number: currentWeek.week_number
                });

                if (error) throw error;

                if (data.success) {
                    userCommittedIn = true;
                    currentWeek.commitment_count = data.new_count;
                    showToast('You\'re in! See you Friday at noon.');
                    render();
                } else if (data.error === 'already_committed') {
                    userCommittedIn = true;
                    showToast('You\'re already committed!');
                    render();
                }
            } catch (err) {
                console.error('Commit failed:', err);
                btn.disabled = false;
                btn.textContent = 'I\'M IN';
                showToast('Failed to commit. Try again.', true);
            }
        }

        // Phase 3: User confirms they cancelled ("I Did It")
        async function confirmCancelled() {
            if (userConfirmed) {
                showToast('Already confirmed!');
                openStoryModal();
                return;
            }

            const btn = document.getElementById('confirm-btn');
            btn.disabled = true;
            btn.textContent = 'CONFIRMING...';

            if (DEMO_MODE) {
                const demo = getDemoData();
                demo.confirmed_count = (demo.confirmed_count || 0) + 1;
                demo.confirmed = true;
                saveDemoData(demo);

                userConfirmed = true;
                currentWeek.confirmed_count = demo.confirmed_count;
                showToast('You did it! Welcome to the resistance.');
                render();
                setTimeout(() => openStoryModal(), 600);
                return;
            }

            // Supabase mode
            try {
                const { data, error } = await supabaseClient.rpc('confirm_cancellation', {
                    p_fingerprint_hash: FINGERPRINT,
                    p_week_number: currentWeek.week_number
                });

                if (error) throw error;

                if (data.success) {
                    userConfirmed = true;
                    currentWeek.confirmed_count = data.new_count;
                    showToast('You did it! Welcome to the resistance.');
                    render();
                    setTimeout(() => openStoryModal(), 600);
                } else if (data.error === 'already_confirmed') {
                    userConfirmed = true;
                    showToast('Already confirmed!');
                    render();
                }
            } catch (err) {
                console.error('Confirm failed:', err);
                btn.disabled = false;
                btn.textContent = 'I DID IT';
                showToast('Failed to confirm. Try again.', true);
            }
        }

        // Toggle "Don't Have It" section
        function toggleDontHave() {
            const section = document.getElementById('dont-have-section');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        // ============================================
        // RENDER
        // ============================================
        function formatDropDate(dateStr) {
            const date = new Date(dateStr);
            const options = { weekday: 'long', month: 'short', day: 'numeric' };
            const dateFormatted = date.toLocaleDateString('en-US', options).toUpperCase();
            const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZoneName: 'short' });
            return `${dateFormatted} â€¢ ${timeStr}`;
        }

        function formatStoryDate(dateStr) {
            const date = new Date(dateStr);
            const day = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }).toUpperCase();
            const time = date.toLocaleTimeString('en-US', { hour: 'numeric', timeZoneName: 'short' }).replace(':00 ', ' ');
            return `${day} â€¢ ${time}`;
        }

        function getTimeRemaining() {
            const now = new Date();
            const dropTime = new Date(currentWeek.drop_time);
            const diff = dropTime - now;

            if (diff <= 0) return { expired: true };

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            return { days, hours, minutes, seconds, expired: false };
        }

        function formatCountdown(time) {
            if (time.expired) return 'NOW!';
            return `${String(time.days).padStart(2, '0')}:${String(time.hours).padStart(2, '0')}:${String(time.minutes).padStart(2, '0')}:${String(time.seconds).padStart(2, '0')}`;
        }

        function render() {
            const phase = getCurrentPhase();
            const time = getTimeRemaining();

            // Sort candidates to find leader/winner
            const sortedCandidates = [...candidates].sort((a, b) => {
                const scoreA = CANDIDATES.find(cd => cd.id === a.id)?.score || 0;
                const scoreB = CANDIDATES.find(cd => cd.id === b.id)?.score || 0;
                return scoreB - scoreA || b.vote_count - a.vote_count;
            });
            const leader = sortedCandidates[0];
            const winner = (phase !== 'VOTING') ? leader : null;

            // Total votes
            const totalVotes = candidates.reduce((sum, c) => sum + c.vote_count, 0);
            document.getElementById('total-votes').textContent = totalVotes.toLocaleString();

            // Week badge
            document.getElementById('week-badge').textContent = `WEEK ${currentWeek.week_number}`;

            // Update main title based on phase
            const mainTitle = document.getElementById('main-title');
            const mainSubtitle = document.getElementById('main-subtitle');

            if (phase === 'VOTING') {
                mainTitle.textContent = 'CHOOSE YOUR TARGET';
                mainSubtitle.innerHTML = 'Pick this week\'s target. Click to see the receipts. <a href="why.html" style="color: var(--orange); text-decoration: none;">Why these companies? â†’</a>';
            } else if (phase === 'TARGET_LOCKED') {
                mainTitle.textContent = 'THIS FRIDAY\'S TARGET';
                mainSubtitle.textContent = 'Voting is closed. Get ready to cancel at noon.';
            } else if (phase === 'DROP_TIME') {
                mainTitle.innerHTML = '<span class="now-badge">NOW. CANCEL NOW.</span>';
                mainSubtitle.textContent = 'The moment is here. Cancel and confirm below.';
            } else {
                mainTitle.textContent = 'WEEK ' + currentWeek.week_number + ' COMPLETE';
                mainSubtitle.textContent = 'Next week\'s voting opens Monday.';
            }

            // Candidates grid
            const grid = document.getElementById('candidates-grid');
            const maxVotes = Math.max(...candidates.map(c => c.vote_count), 1);
            const canVote = phase === 'VOTING' && !userVotedFor;

            grid.innerHTML = sortedCandidates.slice(0, 8).map((c, i) => {
                const pct = totalVotes > 0 ? Math.round((c.vote_count / maxVotes) * 100) : 0;
                const isVoted = userVotedFor === c.id;
                const isSelected = selectedCandidate === c.id;
                const isLeader = i === 0 && c.vote_count > 0;
                const isWinner = winner && winner.id === c.id;
                const candidateData = CANDIDATES.find(cd => cd.id === c.id);
                const logo = candidateData?.logo || '';

                const score = candidateData?.score || 0;
                const scoreTier = score >= 7 ? 'score-high' : score >= 5 ? 'score-mid' : 'score-low';

                return `
                    <div class="candidate-card ${isVoted ? 'voted' : ''} ${isSelected ? 'selected' : ''} ${isLeader ? 'leader' : ''} ${isWinner ? 'winner' : ''}"
                         onclick="selectCandidate('${c.id}')"
                         style="cursor: pointer">
                        <div class="score-badge ${scoreTier}">${score}/10</div>
                        ${logo ? `<img src="${logo}" alt="${c.name}" class="candidate-logo" onerror="this.style.display='none'">` : ''}
                        <div class="candidate-name">${c.name}</div>
                        <div class="candidate-parent">${c.parent}</div>
                        <div class="vote-bar">
                            <div class="vote-fill" style="width: ${pct}%"></div>
                        </div>
                        <div class="vote-count">${c.vote_count > 0 ? c.vote_count.toLocaleString() + ' votes' : '0 votes'}</div>
                        ${isVoted ? '<div class="your-vote-badge">YOUR VOTE</div>' : ''}
                        ${isWinner && phase !== 'VOTING' ? '<div class="your-vote-badge" style="background: var(--red)">TARGET</div>' : ''}
                    </div>
                `;
            }).join('');

            // Details indicator
            const indicator = document.getElementById('details-indicator');
            if (!indicator) {
                const div = document.createElement('div');
                div.id = 'details-indicator';
                div.className = 'details-indicator';
                grid.parentNode.insertBefore(div, grid.nextSibling);
            }
            const ind = document.getElementById('details-indicator');
            ind.style.display = selectedCandidate ? 'block' : 'none';
            ind.innerHTML = 'â†“ details below';

            // Render target section based on phase
            renderTargetSection(phase, winner, time);

            // Salted list
            renderSaltedList();

            // Story modal data
            renderStoryData(winner, leader);

            // After week section
            document.getElementById('after-week-section').style.display = phase === 'AFTER' ? 'block' : 'none';
        }

        function renderTargetSection(phase, winner, time) {
            const targetLabel = document.getElementById('target-label');
            const currentTarget = document.getElementById('current-target');
            const currentParent = document.getElementById('current-parent');
            const whyBox = document.getElementById('why-box');
            const howBox = document.getElementById('how-box');
            const dropInfo = document.getElementById('drop-info');
            const participantsSection = document.getElementById('participants-section');
            const actionButtons = document.getElementById('action-buttons');
            const statusNote = document.getElementById('status-note');

            // Get the candidate to display
            let displayCandidate = null;
            // Always show selected candidate if one is clicked, otherwise show voted/winner
            const candidateId = selectedCandidate || userVotedFor || (winner ? winner.id : null);
            displayCandidate = candidateId ? CANDIDATES.find(c => c.id === candidateId) : null;

            if (!displayCandidate) {
                // Nothing selected yet
                targetLabel.textContent = 'Select a company above to see why';
                currentTarget.textContent = '';
                currentParent.textContent = '';
                whyBox.style.display = 'none';
                howBox.style.display = 'none';
                dropInfo.style.display = 'none';
                participantsSection.style.display = 'none';
                actionButtons.style.display = 'none';
                statusNote.style.display = 'none';
                return;
            }

            // Show candidate info
            currentTarget.textContent = displayCandidate.name.toUpperCase();
            currentParent.textContent = displayCandidate.parent;

            // Why box
            whyBox.style.display = 'block';
            whyBox.innerHTML = `
                <div class="why-title">${displayCandidate.why.title}</div>
                <ul class="why-list">
                    ${displayCandidate.why.reasons.map(r => {
                        if (r.source) {
                            return `<li>${r.text} <a href="${r.source}" target="_blank" rel="noopener" style="color: var(--orange); font-size: 0.6rem;">[source]</a></li>`;
                        }
                        return `<li>${r.text}</li>`;
                    }).join('')}
                </ul>
            `;

            // How box - show in Phase 2, Phase 3, and after voting in Phase 1
            if (phase === 'TARGET_LOCKED' || phase === 'DROP_TIME') {
                howBox.style.display = 'block';
                const linkHtml = displayCandidate.how.link
                    ? `<a href="${displayCandidate.how.link}" target="_blank" rel="noopener" class="cancel-link">${displayCandidate.how.linkText}</a>`
                    : `<span class="cancel-link" style="opacity: 0.7;">${displayCandidate.how.linkText}</span>`;
                howBox.innerHTML = `
                    <div class="how-title">${displayCandidate.how.title}</div>
                    <ol class="how-steps">
                        ${displayCandidate.how.steps.map(s => `<li>${s}</li>`).join('')}
                    </ol>
                    ${linkHtml}
                `;
            } else {
                howBox.style.display = 'none';
            }

            // Phase-specific UI
            const voteBtn = document.getElementById('vote-btn');
            const commitBtn = document.getElementById('commit-btn');
            const dontHaveBtn = document.getElementById('dont-have-btn');
            const confirmBtn = document.getElementById('confirm-btn');
            const shareBtn = document.getElementById('share-btn');
            const dropLabel = document.getElementById('drop-label');
            const participantsLabel = document.getElementById('participants-label');

            // Hide all buttons and post-vote elements first
            voteBtn.style.display = 'none';
            commitBtn.style.display = 'none';
            dontHaveBtn.style.display = 'none';
            confirmBtn.style.display = 'none';
            shareBtn.style.display = 'none';
            document.getElementById('vote-summary').style.display = 'none';
            document.getElementById('change-vote-btn').style.display = 'none';
            document.getElementById('cancel-preview').style.display = 'none';

            if (phase === 'VOTING') {
                targetLabel.textContent = userVotedFor ? 'You voted for' : 'Review and cast your vote';
                dropInfo.style.display = 'none';
                participantsSection.style.display = 'none';
                actionButtons.style.display = 'flex';

                if (userVotedFor) {
                    // Vote summary with social proof
                    const votedCandidate = candidates.find(c => c.id === userVotedFor);
                    const voteSummary = document.getElementById('vote-summary');
                    const voteSummaryText = document.getElementById('vote-summary-text');
                    const voteComparison = document.getElementById('vote-comparison');
                    const changeVoteBtn = document.getElementById('change-vote-btn');

                    voteSummaryText.innerHTML = `You voted for <strong>${votedCandidate?.name || ''}</strong>. ${votedCandidate && votedCandidate.vote_count > 1 ? (votedCandidate.vote_count - 1).toLocaleString() + ' others agree.' : ''} Share to build momentum.`;

                    // Mini comparison
                    const sorted = [...candidates].sort((a, b) => b.vote_count - a.vote_count).slice(0, 3);
                    voteComparison.innerHTML = sorted.map(c => `<span>${c.name}: <strong>${c.vote_count.toLocaleString()}</strong></span>`).join('');

                    changeVoteBtn.style.display = 'inline-block';
                    changeVoteBtn.onclick = changeVote;
                    voteSummary.style.display = 'block';

                    // Cancel preview
                    const cancelPreview = document.getElementById('cancel-preview');
                    const cancelSteps = document.getElementById('cancel-preview-steps');
                    cancelSteps.innerHTML = displayCandidate.how.steps.map(s => `<li>${s}</li>`).join('');
                    cancelPreview.style.display = 'block';

                    statusNote.style.display = 'block';
                    statusNote.textContent = 'Come back Friday to cancel together!';
                    shareBtn.style.display = 'inline-block';
                } else if (selectedCandidate) {
                    voteBtn.style.display = 'inline-block';
                    voteBtn.disabled = false;
                    voteBtn.textContent = 'VOTE FOR THIS TARGET';
                    voteBtn.onclick = () => voteForCandidate(selectedCandidate);
                    statusNote.style.display = 'none';
                }

            } else if (phase === 'TARGET_LOCKED') {
                targetLabel.textContent = 'THIS FRIDAY\'S TARGET';
                dropInfo.style.display = 'flex';
                dropLabel.textContent = 'We all cancel at';
                document.getElementById('drop-date').textContent = formatDropDate(currentWeek.drop_time);
                document.getElementById('countdown').textContent = formatCountdown(time);

                participantsSection.style.display = 'block';
                document.getElementById('participants-count').textContent = currentWeek.commitment_count.toLocaleString();
                participantsLabel.textContent = 'people committed';

                actionButtons.style.display = 'flex';
                statusNote.style.display = 'block';

                if (userCommittedIn) {
                    commitBtn.style.display = 'inline-block';
                    commitBtn.textContent = 'YOU\'RE IN âœ“';
                    commitBtn.disabled = true;
                    commitBtn.classList.add('committed');
                    shareBtn.style.display = 'inline-block';
                    statusNote.textContent = 'See you at noon!';
                } else {
                    commitBtn.style.display = 'inline-block';
                    commitBtn.textContent = 'I\'M IN';
                    commitBtn.disabled = false;
                    commitBtn.onclick = commitToCancel;
                    dontHaveBtn.style.display = 'inline-block';
                    dontHaveBtn.onclick = toggleDontHave;
                    shareBtn.style.display = 'inline-block';
                    statusNote.textContent = 'Click "I\'m In" if you have this subscription and will cancel on Friday.';
                }

            } else if (phase === 'DROP_TIME') {
                targetLabel.textContent = 'CANCEL NOW';
                dropInfo.style.display = 'flex';
                dropLabel.textContent = 'IT\'S TIME';
                document.getElementById('drop-date').textContent = 'NOW';
                document.getElementById('countdown').textContent = 'GO!';

                participantsSection.style.display = 'block';
                document.getElementById('participants-count').textContent = (currentWeek.confirmed_count || 0).toLocaleString();
                participantsLabel.textContent = 'confirmed cancellations';

                actionButtons.style.display = 'flex';
                statusNote.style.display = 'block';

                if (userConfirmed) {
                    confirmBtn.style.display = 'inline-block';
                    confirmBtn.textContent = 'CANCELLED âœ“';
                    confirmBtn.disabled = true;
                    confirmBtn.classList.add('committed');
                    shareBtn.style.display = 'inline-block';
                    statusNote.textContent = 'You did it! Share your victory.';
                } else {
                    confirmBtn.style.display = 'inline-block';
                    confirmBtn.textContent = 'I DID IT';
                    confirmBtn.disabled = false;
                    confirmBtn.onclick = confirmCancelled;
                    dontHaveBtn.style.display = 'inline-block';
                    dontHaveBtn.onclick = toggleDontHave;
                    shareBtn.style.display = 'inline-block';
                    statusNote.textContent = 'Cancel now, then click "I Did It" to be counted.';
                }

            } else { // AFTER
                targetLabel.textContent = 'WEEK ' + currentWeek.week_number + ' RESULTS';
                dropInfo.style.display = 'none';
                participantsSection.style.display = 'block';
                document.getElementById('participants-count').textContent = (currentWeek.confirmed_count || 0).toLocaleString();
                participantsLabel.textContent = 'confirmed cancellations';
                actionButtons.style.display = 'flex';
                shareBtn.style.display = 'inline-block';
                statusNote.style.display = 'block';
                statusNote.textContent = 'Next week\'s voting opens Monday.';
            }
        }

        function renderSaltedList() {
            const saltedList = document.getElementById('salted-list');
            if (SALTED.length > 0) {
                saltedList.innerHTML = SALTED.map(s => `
                    <div class="salted-item">
                        <div class="salted-name">${s.name}</div>
                        <div class="salted-stats">Week ${s.week} â€¢ ${s.cancellations?.toLocaleString() || '?'} cancellations</div>
                    </div>
                `).join('');
            } else {
                saltedList.innerHTML = '<div class="salted-empty">Week 1 â€” You\'re here at the beginning</div>';
            }
        }

        function renderStoryData(winner, leader) {
            const storyCandidate = winner
                ? CANDIDATES.find(c => c.id === winner.id)
                : (userVotedFor
                    ? CANDIDATES.find(c => c.id === userVotedFor)
                    : (leader ? CANDIDATES.find(c => c.id === leader.id) : CANDIDATES[0]));

            document.getElementById('story-week').textContent = `WEEK ${currentWeek.week_number}`;
            document.getElementById('story-target').textContent = storyCandidate?.name.toUpperCase() || '';
            document.getElementById('story-datetime').textContent = formatStoryDate(currentWeek.drop_time);

            const phase = getCurrentPhase();
            const storyAction = document.getElementById('story-action');
            const storyCommitted = document.getElementById('story-committed');

            if (phase === 'DROP_TIME' || phase === 'AFTER') {
                const count = currentWeek.confirmed_count || 0;
                storyAction.textContent = userConfirmed ? 'I cancelled' : 'We\'re canceling';
                if (count >= 10) {
                    storyCommitted.textContent = `${count.toLocaleString()} cancelled`;
                    storyCommitted.style.display = 'inline-block';
                } else {
                    storyCommitted.textContent = 'Join the first wave';
                    storyCommitted.style.display = 'inline-block';
                }
            } else if (phase === 'TARGET_LOCKED') {
                storyAction.textContent = 'I\'m canceling';
                const count = currentWeek.commitment_count || 0;
                if (count >= 10) {
                    storyCommitted.textContent = `${count.toLocaleString()} committed`;
                    storyCommitted.style.display = 'inline-block';
                } else {
                    storyCommitted.textContent = 'Join the first wave';
                    storyCommitted.style.display = 'inline-block';
                }
            } else {
                // VOTING phase
                storyAction.textContent = 'I\'m voting to cancel';
                const totalVotes = candidates.reduce((sum, c) => sum + c.vote_count, 0);
                if (totalVotes >= 10) {
                    storyCommitted.textContent = `${totalVotes.toLocaleString()} votes cast`;
                    storyCommitted.style.display = 'inline-block';
                } else {
                    storyCommitted.textContent = 'Join the first wave';
                    storyCommitted.style.display = 'inline-block';
                }
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
            if (DEMO_MODE) {
                document.getElementById('mode-badge').innerHTML = 'âš¡ Demo Mode';
                document.getElementById('mode-badge').style.color = 'var(--orange)';
            }
        }

        function openStoryModal() {
            document.getElementById('story-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('story-modal').classList.remove('active');
        }

        async function getStoryCanvas() {
            const storyContent = document.getElementById('story-content');
            return await html2canvas(storyContent, {
                backgroundColor: '#0a0a0a',
                scale: 2,
                width: 270,
                height: 480
            });
        }

        async function getStoryBlob() {
            const canvas = await getStoryCanvas();
            return new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        }

        async function saveStory() {
            try {
                const blob = await getStoryBlob();
                const file = new File([blob], `salt-week${currentWeek.week_number}.png`, { type: 'image/png' });

                // Try Web Share API first (works great on mobile)
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'Cancel Friday',
                        text: '#CancelFriday #SaltTheEarth'
                    });
                    showToast('Share it everywhere!');
                } else {
                    // Fallback to download
                    const canvas = await getStoryCanvas();
                    const link = document.createElement('a');
                    link.download = `salt-week${currentWeek.week_number}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    showToast('Saved! Share it everywhere.');
                }
            } catch (err) {
                if (err.name !== 'AbortError') {
                    showToast('Save failed. Try screenshot.', true);
                }
            }
        }

        async function copyStory() {
            try {
                const blob = await getStoryBlob();
                await navigator.clipboard.write([
                    new ClipboardItem({ 'image/png': blob })
                ]);
                showToast('Copied! Paste anywhere.');
            } catch (err) {
                showToast('Copy failed. Try Save instead.', true);
            }
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ============================================
        // INIT
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            try {
                loadData();
                updateDebugPanel();
            } catch (err) {
                console.error('Load error:', err);
                hideLoading();
            }
            setInterval(() => {
                try {
                    const time = getTimeRemaining();
                    const countdownEl = document.getElementById('countdown');
                    if (countdownEl) countdownEl.textContent = formatCountdown(time);
                    updateDebugPanel();
                } catch (e) {}
            }, 1000);

            document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
            document.getElementById('story-modal').addEventListener('click', e => {
                if (e.target.id === 'story-modal') closeModal();
            });
        });

        // Fallback: hide loading after 3 seconds no matter what
        setTimeout(() => {
            const loader = document.getElementById('loading');
            if (loader && !loader.classList.contains('hidden')) {
                console.warn('Force hiding loader');
                hideLoading();
            }
        }, 3000);
    </script>

    <!-- Analytics -->
    <script data-goatcounter="https://salt.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
</body>
</html>
